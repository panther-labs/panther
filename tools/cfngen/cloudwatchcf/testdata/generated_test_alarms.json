{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Panther Alarms",
  "Parameters": {
    "AlarmTopicArn": {
      "Type": "String"
    }
  },
  "Resources": {
    "PantherAlarmLambdaApplicationErrorstestlambda": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-LambdaApplicationErrors-test-lambda",
        "AlarmDescription": "Lambda test-lambda is failing. See: https://docs.runpanther.io/operations/runbooks#test-lambda",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "Panther",
        "MetricName": "test-lambda-errors",
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 2,
        "Period": 300,
        "Threshold": 0,
        "Unit": "None",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmLambdaApplicationWarnstestlambda": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-LambdaApplicationWarns-test-lambda",
        "AlarmDescription": "Lambda test-lambda is warning. See: https://docs.runpanther.io/operations/runbooks#test-lambda",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "Panther",
        "MetricName": "test-lambda-warns",
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 25,
        "Unit": "None",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmLambdaErrorstestlambda": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-LambdaErrors-test-lambda",
        "AlarmDescription": "Lambda test-lambda is failing. See: https://docs.runpanther.io/operations/runbooks#test-lambda",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/Lambda",
        "MetricName": "Errors",
        "Dimensions": [{ "Name": "FunctionName", "Value": "test-lambda" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 2,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmLambdaHighExecutionTimeWarntestlambda": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-LambdaHighExecutionTimeWarn-test-lambda",
        "AlarmDescription": "Lambda test-lambda is using more than 90% of available execution time (60000msec). See: https://docs.runpanther.io/operations/runbooks#test-lambda",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/Lambda",
        "MetricName": "Duration",
        "Dimensions": [{ "Name": "FunctionName", "Value": "test-lambda" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 3,
        "Period": 300,
        "Threshold": 54000,
        "Unit": "Milliseconds",
        "Statistic": "Maximum"
      }
    },
    "PantherAlarmLambdaHighMemoryWarntestlambda": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-LambdaHighMemoryWarn-test-lambda",
        "AlarmDescription": "Lambda test-lambda is using more than 90% of available memory (128MB). See: https://docs.runpanther.io/operations/runbooks#test-lambda",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "Panther",
        "MetricName": "test-lambda-memory",
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 3,
        "Period": 300,
        "Threshold": 115.2,
        "Unit": "None",
        "Statistic": "Maximum"
      }
    },
    "PantherAlarmLambdaThrottlestestlambda": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-LambdaThrottles-test-lambda",
        "AlarmDescription": "Lambda test-lambda is being throttled. See: https://docs.runpanther.io/operations/runbooks#test-lambda",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/Lambda",
        "MetricName": "Throttles",
        "Dimensions": [{ "Name": "FunctionName", "Value": "test-lambda" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 5,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSFNErrormystatemachine": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SFNError-my-state-machine",
        "AlarmDescription": "State machine my-state-machine is failing. See: https://docs.runpanther.io/operations/runbooks#my-state-machine",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/States",
        "MetricName": "ExecutionsFailed",
        "Dimensions": [
          {
            "Name": "StateMachineArn",
            "Value": {
              "Fn::Sub": "arn:${AWS::Partition}:states:${AWS::Region}:${AWS::AccountId}:stateMachine:my-state-machine"
            }
          }
        ],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSNSErrortestnotifications": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SNSError-test-notifications",
        "AlarmDescription": "SNS topic test-notifications is failing. See: https://docs.runpanther.io/operations/runbooks#test-notifications",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/SNS",
        "MetricName": "NumberOfNotificationsFailed",
        "Dimensions": [{ "Name": "TopicName", "Value": "test-notifications" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSQSDeadLetterstestsqsdlq": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SQSDeadLetters-test-sqs-dlq",
        "AlarmDescription": "SQS queue test-sqs-dlq has failed items from test-sqs. See: https://docs.runpanther.io/operations/runbooks#test-sqs-dlq",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/SQS",
        "MetricName": "ApproximateNumberOfMessagesVisible",
        "Dimensions": [{ "Name": "QueueName", "Value": "test-sqs-dlq" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSQSTooOldtestsqs": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SQSTooOld-test-sqs",
        "AlarmDescription": "SQS queue test-sqs has items not being processed at the expected rate. See: https://docs.runpanther.io/operations/runbooks#test-sqs",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/SQS",
        "MetricName": "ApproximateAgeOfOldestMessage",
        "Dimensions": [{ "Name": "QueueName", "Value": "test-sqs" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 900,
        "Unit": "Seconds",
        "Statistic": "Maximum"
      }
    }
  }
}
