{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Panther Alarms",
  "Parameters": {
    "AlarmTopicArn": {
      "Type": "String"
    }
  },
  "Resources": {
    "PantherAlarmSFNErrormystatemachine": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SFNError-my-state-machine",
        "AlarmDescription": "State machine my-state-machine is failing. See: https://docs.runpanther.io/operations/runbooks#my-state-machine",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/States",
        "MetricName": "ExecutionsFailed",
        "Dimensions": [
          {
            "Name": "StateMachineArn",
            "Value": {
              "Fn::Sub": "arn:${AWS::Partition}:states:${AWS::Region}:${AWS::AccountId}:stateMachine:my-state-machine"
            }
          }
        ],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSNSErrortestnotifications": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SNSError-test-notifications",
        "AlarmDescription": "SNS topic test-notifications is failing. See: https://docs.runpanther.io/operations/runbooks#test-notifications",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/SNS",
        "MetricName": "NumberOfNotificationsFailed",
        "Dimensions": [{ "Name": "TopicName", "Value": "test-notifications" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSQSDeadLetterstestsqsdlq": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SQSDeadLetters-test-sqs-dlq",
        "AlarmDescription": "SQS queue test-sqs-dlq has failed items from test-sqs. See: https://docs.runpanther.io/operations/runbooks#test-sqs-dlq",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/SQS",
        "MetricName": "ApproximateNumberOfMessagesVisible",
        "Dimensions": [{ "Name": "QueueName", "Value": "test-sqs-dlq" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 0,
        "Unit": "Count",
        "Statistic": "Sum"
      }
    },
    "PantherAlarmSQSTooOldtestsqs": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "PantherAlarm-SQSTooOld-test-sqs",
        "AlarmDescription": "SQS queue test-sqs has items not being processed at the expected rate. See: https://docs.runpanther.io/operations/runbooks#test-sqs",
        "AlarmActions": [
          {
            "Ref": "AlarmTopicArn"
          }
        ],
        "TreatMissingData": "notBreaching",
        "Namespace": "AWS/SQS",
        "MetricName": "ApproximateAgeOfOldestMessage",
        "Dimensions": [{ "Name": "QueueName", "Value": "test-sqs" }],
        "ComparisonOperator": "GreaterThanThreshold",
        "EvaluationPeriods": 1,
        "Period": 300,
        "Threshold": 900,
        "Unit": "Seconds",
        "Statistic": "Maximum"
      }
    }
  }
}
